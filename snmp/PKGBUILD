targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-snmp"
pkgver="1.0.0"
pkgrel="1"
pkgdesc="An open-source, community-driven email server"
pkgdesclong=(
  "An open-source, community-driven email server"
)
maintainer="Zextras <packages@zextras.com>"
url="https://zextras.com"
section="mail"
priority="optional"
arch="amd64"
depends=(
  "carbonio-core"
  "carbonio-snmp-components"
)

package() {
  cd "${srcdir}"/../../
  install -D opt/zextras/common/conf/snmp.conf \
    "${pkgdir}/opt/zextras/common/conf/snmp.conf"
  install -D opt/zextras/common/share/snmp/mibs/zimbra.mib \
    "${pkgdir}/opt/zextras/common/share/snmp/mibs/zimbra.mib"
  install -D opt/zextras/common/share/snmp/mibs/zimbra_traps.mib \
    "${pkgdir}/opt/zextras/common/share/snmp/mibs/zimbra_traps.mib"
  install -D opt/zextras/common/share/snmp/snmp.conf \
    "${pkgdir}/opt/zextras/common/share/snmp/snmp.conf"
  install -D opt/zextras/conf/snmpd.conf.in \
    "${pkgdir}/opt/zextras/conf/snmpd.conf.in"
}

postinst() {
  mkdir -p /opt/zextras/data/snmp/persist
  mkdir -p /opt/zextras/data/snmp/state
  chown -R zimbra:zimbra /opt/zextras/data/snmp
  chown zimbra:zimbra /opt/zextras/data
  chown root:root /opt/zextras/common/share/snmp/mibs/*.mib
  chown root:root /opt/zextras/common/share/snmp/snmp.conf
  chown root:root /opt/zextras/common/conf/snmp.conf
}
