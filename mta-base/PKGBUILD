targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-mta-base"
pkgver="21.00"
pkgrel="1"
pkgdesc="Carbonio mta base"
pkgdesclong=(
  "Carbonio mta base is used as a simple method to allow removing"
  "all the mta specific packages."
)
arch="amd64"
maintainer="Zextras <packages@zextras.com>"
url="https://zextras.com"
depends=(
  "carbonio-base"
)
section="mail"
priority="optional"

package() {
  cd "${srcdir}"/../../
}

postinst:apt() {
  #!/bin/bash
  if [ "$1" = configure ]; then
    grp_exists() {
      if [ -x /usr/bin/getent ]; then
        getent group $1 >/dev/null 2>&1
        FOUND=$?
      else
        grep -E -q "^$1:" /etc/group
        FOUND=$?
      fi
      return $FOUND
    }

    acct_exists() {
      if [ -x /usr/bin/getent ]; then
        getent passwd $1 >/dev/null 2>&1
        return $?
      else
        grep -E -q "^$1:" /etc/passwd
        return $?
      fi
    }

    grp_exists postfix
    if [ $? != 0 ]; then
      groupadd -r postfix
    fi

    grp_exists postdrop
    if [ $? != 0 ]; then
      groupadd -r postdrop
    fi

    acct_exists postfix
    if [ $? != 0 ]; then
      useradd -r -g postfix -d /opt/zextras/postfix postfix
      /bin/rm -rf /opt/zextras/postfix
    fi

    usermod -a -G postfix,tty zextras
  fi
  exit 0

}

postinst:yum() {
  grp_exists() {
    if [ -x /usr/bin/getent ]; then
      getent group $1 >/dev/null 2>&1
      FOUND=$?
    else
      grep -E -q "^$1:" /etc/group
      FOUND=$?
    fi
    return $FOUND
  }

  acct_exists() {
    if [ -x /usr/bin/getent ]; then
      getent passwd $1 >/dev/null 2>&1
      return $?
    else
      grep -E -q "^$1:" /etc/passwd
      return $?
    fi
  }

  grp_exists postfix
  if [ $? != 0 ]; then
    groupadd -r postfix
  fi

  grp_exists postdrop
  if [ $? != 0 ]; then
    groupadd -r postdrop
  fi

  acct_exists postfix
  if [ $? != 0 ]; then
    useradd -r -g postfix -d /opt/zextras/postfix postfix
    if [ -L /opt/zextras/postfix ]; then
      /bin/rm -rf /opt/zextras/postfix
    fi
  fi
  usermod -a -G postfix,tty zextras

}
